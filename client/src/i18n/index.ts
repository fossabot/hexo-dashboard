import { ref } from 'vue';

export type Language = 'zh-CN' | 'zh-TW' | 'en' | 'ja' | 'ko' | 'fr' | 'de' | 'es' | 'ru' | 'pt';

export interface LanguageOption {
  code: Language;
  name: string;
  nativeName: string;
}

export const languages: LanguageOption[] = [
  { code: 'zh-CN', name: 'Chinese (Simplified)', nativeName: '简体中文' },
  { code: 'zh-TW', name: 'Chinese (Traditional)', nativeName: '繁體中文' },
  { code: 'en', name: 'English', nativeName: 'English' },
  { code: 'ja', name: 'Japanese', nativeName: '日本語' },
  { code: 'ko', name: 'Korean', nativeName: '한국어' },
  { code: 'fr', name: 'French', nativeName: 'Français' },
  { code: 'de', name: 'German', nativeName: 'Deutsch' },
  { code: 'es', name: 'Spanish', nativeName: 'Español' },
  { code: 'ru', name: 'Russian', nativeName: 'Русский' },
  { code: 'pt', name: 'Portuguese', nativeName: 'Português' },
];

const messages: Record<Language, Record<string, string>> = {
  'zh-CN': {
    // Navigation
    'nav.posts': '文章',
    'nav.pages': '页面',
    'nav.mainConfig': '站点配置',
    'nav.themeConfig': '主题配置',

    // Common
    'common.search': '搜索',
    'common.edit': '编辑',
    'common.delete': '删除',
    'common.save': '保存 (Ctrl+S)',
    'common.cancel': '取消',
    'common.confirm': '确认',
    'common.back': '返回',
    'common.success': '操作成功',
    'common.title': '标题',
    'common.date': '日期',
    'common.updated': '更新时间',
    'common.actions': '操作',
    'common.status': '状态',
    'common.draft': '草稿',
    'common.published': '已发布',
    'common.publish': '发布',
    'common.unpublish': '撤回',
    'common.category': '分类',
    'common.tag': '标签',
    'common.all': '全部',
    'common.reset': '重置',

    // Posts
    'posts.title': '文章管理',
    'posts.newPost': '新建文章',
    'posts.editPost': '编辑文章',
    'posts.deleteConfirm': '确定要删除这篇文章吗？',
    'posts.publishConfirm': '确定要发布这篇文章吗？',
    'posts.unpublishConfirm': '确定要撤回这篇文章吗？',

    // Pages
    'pages.title': '页面管理',
    'pages.newPage': '新建页面',
    'pages.editPage': '编辑页面',
    'pages.deleteConfirm': '确定要删除这个页面吗？',

    // Config
    'config.main': '站点配置',
    'config.theme': '主题配置',
    'config.saveSuccess': '配置保存成功',
    'config.saveError': '配置保存失败',

    // Editor
    'editor.meta': '元数据',
    'editor.content': '内容',
    'editor.uploading': '上传中...',

    // Auth
    'auth.login': '登录',
    'auth.submit': '提交',
    'auth.username': '用户名',
    'auth.password': '密码',
    'auth.loginSuccess': '登录成功',
    'auth.loginError': '登录失败，请检查用户名和密码',

    // Settings
    'settings.darkMode': '深色模式',
    'settings.lightMode': '浅色模式',
  },
  'zh-TW': {
    'nav.posts': '文章',
    'nav.pages': '頁面',
    'nav.mainConfig': '站點配置',
    'nav.themeConfig': '主題配置',
    'common.search': '搜索',
    'common.edit': '編輯',
    'common.delete': '刪除',
    'common.save': '保存 (Ctrl+S)',
    'common.cancel': '取消',
    'common.confirm': '確認',
    'common.back': '返回',
    'common.success': '操作成功',
    'common.title': '標題',
    'common.date': '日期',
    'common.updated': '更新時間',
    'common.actions': '操作',
    'common.status': '狀態',
    'common.draft': '草稿',
    'common.published': '已發佈',
    'common.publish': '發佈',
    'common.unpublish': '撤回',
    'common.category': '分類',
    'common.tag': '標籤',
    'common.all': '全部',
    'common.reset': '重置',
    'posts.title': '文章管理',
    'posts.newPost': '新建文章',
    'posts.editPost': '編輯文章',
    'posts.deleteConfirm': '確定要刪除這篇文章嗎？',
    'posts.publishConfirm': '確定要發佈這篇文章嗎？',
    'posts.unpublishConfirm': '確定要撤回這篇文章嗎？',
    'pages.title': '頁面管理',
    'pages.newPage': '新建頁面',
    'pages.editPage': '編輯頁面',
    'pages.deleteConfirm': '確定要刪除這個頁面嗎？',
    'config.main': '站點配置',
    'config.theme': '主題配置',
    'config.saveSuccess': '配置保存成功',
    'config.saveError': '配置保存失敗',
    'editor.meta': '元數據',
    'editor.content': '內容',
    'editor.uploading': '上傳中...',
    'auth.login': '登錄',
    'auth.submit': '提交',
    'auth.username': '用戶名',
    'auth.password': '密碼',
    'auth.loginSuccess': '登錄成功',
    'auth.loginError': '登錄失敗，請檢查用戶名和密碼',
    'settings.darkMode': '深色模式',
    'settings.lightMode': '淺色模式',
  },
  'en': {
    'nav.posts': 'Posts',
    'nav.pages': 'Pages',
    'nav.mainConfig': 'Main Config',
    'nav.themeConfig': 'Theme Config',
    'common.search': 'Search',
    'common.edit': 'Edit',
    'common.delete': 'Delete',
    'common.save': 'Save (Ctrl+S)',
    'common.cancel': 'Cancel',
    'common.confirm': 'Confirm',
    'common.back': 'Back',
    'common.success': 'Success',
    'common.title': 'Title',
    'common.date': 'Date',
    'common.updated': 'Updated',
    'common.actions': 'Actions',
    'common.status': 'Status',
    'common.draft': 'Draft',
    'common.published': 'Published',
    'common.publish': 'Publish',
    'common.unpublish': 'Unpublish',
    'common.category': 'Category',
    'common.tag': 'Tag',
    'common.all': 'All',
    'common.reset': 'Reset',
    'posts.title': 'Post Management',
    'posts.newPost': 'New Post',
    'posts.editPost': 'Edit Post',
    'posts.deleteConfirm': 'Are you sure you want to delete this post?',
    'posts.publishConfirm': 'Are you sure you want to publish this post?',
    'posts.unpublishConfirm': 'Are you sure you want to unpublish this post?',
    'pages.title': 'Page Management',
    'pages.newPage': 'New Page',
    'pages.editPage': 'Edit Page',
    'pages.deleteConfirm': 'Are you sure you want to delete this page?',
    'config.main': 'Main Configuration',
    'config.theme': 'Theme Configuration',
    'config.saveSuccess': 'Configuration saved successfully',
    'config.saveError': 'Failed to save configuration',
    'editor.meta': 'Metadata',
    'editor.content': 'Content',
    'editor.uploading': 'Uploading...',
    'auth.login': 'Login',
    'auth.submit': 'Submit',
    'auth.username': 'Username',
    'auth.password': 'Password',
    'auth.loginSuccess': 'Login successful',
    'auth.loginError': 'Login failed, please check username and password',
    'settings.darkMode': 'Dark Mode',
    'settings.lightMode': 'Light Mode',
  },
  'ja': {
    'nav.posts': '記事',
    'nav.pages': 'ページ',
    'nav.mainConfig': 'メイン設定',
    'nav.themeConfig': 'テーマ設定',
    'common.search': '検索',
    'common.edit': '編集',
    'common.delete': '削除',
    'common.save': '保存 (Ctrl+S)',
    'common.cancel': 'キャンセル',
    'common.confirm': '確認',
    'common.back': '戻る',
    'common.success': '成功',
    'common.title': 'タイトル',
    'common.date': '日付',
    'common.updated': '更新日',
    'common.actions': '操作',
    'common.status': 'ステータス',
    'common.draft': '下書き',
    'common.published': '公開済み',
    'common.publish': '公開',
    'common.unpublish': '非公開',
    'common.category': 'カテゴリ',
    'common.tag': 'タグ',
    'common.all': 'すべて',
    'common.reset': 'リセット',
    'posts.title': '記事管理',
    'posts.newPost': '新規記事',
    'posts.editPost': '記事編集',
    'posts.deleteConfirm': 'この記事を削除してもよろしいですか？',
    'posts.publishConfirm': 'この記事を公開してもよろしいですか？',
    'posts.unpublishConfirm': 'この記事を非公開にしてもよろしいですか？',
    'pages.title': 'ページ管理',
    'pages.newPage': '新規ページ',
    'pages.editPage': 'ページ編集',
    'pages.deleteConfirm': 'このページを削除してもよろしいですか？',
    'config.main': 'メイン設定',
    'config.theme': 'テーマ設定',
    'config.saveSuccess': '設定を保存しました',
    'config.saveError': '設定の保存に失敗しました',
    'editor.meta': 'メタデータ',
    'editor.content': 'コンテンツ',
    'editor.uploading': 'アップロード中...',
    'auth.login': 'ログイン',
    'auth.submit': '送信',
    'auth.username': 'ユーザー名',
    'auth.password': 'パスワード',
    'auth.loginSuccess': 'ログインしました',
    'auth.loginError': 'ログインに失敗しました',
    'settings.darkMode': 'ダークモード',
    'settings.lightMode': 'ライトモード',
  },
  'ko': {
    'nav.posts': '글',
    'nav.pages': '페이지',
    'nav.mainConfig': '메인 설정',
    'nav.themeConfig': '테마 설정',
    'common.search': '검색',
    'common.edit': '편집',
    'common.delete': '삭제',
    'common.save': '저장 (Ctrl+S)',
    'common.cancel': '취소',
    'common.confirm': '확인',
    'common.back': '뒤로',
    'common.success': '성공',
    'common.title': '제목',
    'common.date': '날짜',
    'common.updated': '수정일',
    'common.actions': '작업',
    'common.status': '상태',
    'common.draft': '초안',
    'common.published': '게시됨',
    'common.publish': '게시',
    'common.unpublish': '게시 취소',
    'common.category': '카테고리',
    'common.tag': '태그',
    'common.all': '전체',
    'common.reset': '초기화',
    'posts.title': '글 관리',
    'posts.newPost': '새 글',
    'posts.editPost': '글 편집',
    'posts.deleteConfirm': '이 글을 삭제하시겠습니까?',
    'posts.publishConfirm': '이 글을 게시하시겠습니까?',
    'posts.unpublishConfirm': '이 글을 게시 취소하시겠습니까?',
    'pages.title': '페이지 관리',
    'pages.newPage': '새 페이지',
    'pages.editPage': '페이지 편집',
    'pages.deleteConfirm': '이 페이지를 삭제하시겠습니까?',
    'config.main': '메인 설정',
    'config.theme': '테마 설정',
    'config.saveSuccess': '설정이 저장되었습니다',
    'config.saveError': '설정 저장에 실패했습니다',
    'editor.meta': '메타데이터',
    'editor.content': '내용',
    'editor.uploading': '업로드 중...',
    'auth.login': '로그인',
    'auth.submit': '제출',
    'auth.username': '사용자 이름',
    'auth.password': '비밀번호',
    'auth.loginSuccess': '로그인 성공',
    'auth.loginError': '로그인 실패',
    'settings.darkMode': '다크 모드',
    'settings.lightMode': '라이트 모드',
  },
  'fr': {
    'nav.posts': 'Articles',
    'nav.pages': 'Pages',
    'nav.mainConfig': 'Config. Site',
    'nav.themeConfig': 'Config. Thème',
    'common.search': 'Rechercher',
    'common.edit': 'Modifier',
    'common.delete': 'Supprimer',
    'common.save': 'Enregistrer (Ctrl+S)',
    'common.cancel': 'Annuler',
    'common.confirm': 'Confirmer',
    'common.back': 'Retour',
    'common.success': 'Succès',
    'common.title': 'Titre',
    'common.date': 'Date',
    'common.updated': 'Mis à jour',
    'common.actions': 'Actions',
    'common.status': 'Statut',
    'common.draft': 'Brouillon',
    'common.published': 'Publié',
    'common.publish': 'Publier',
    'common.unpublish': 'Dépublier',
    'common.category': 'Catégorie',
    'common.tag': 'Tag',
    'common.all': 'Tous',
    'common.reset': 'Réinitialiser',
    'posts.title': 'Gestion des articles',
    'posts.newPost': 'Nouvel article',
    'posts.editPost': 'Modifier l\'article',
    'posts.deleteConfirm': 'Voulez-vous vraiment supprimer cet article ?',
    'posts.publishConfirm': 'Voulez-vous vraiment publier cet article ?',
    'posts.unpublishConfirm': 'Voulez-vous vraiment dépublier cet article ?',
    'pages.title': 'Gestion des pages',
    'pages.newPage': 'Nouvelle page',
    'pages.editPage': 'Modifier la page',
    'pages.deleteConfirm': 'Voulez-vous vraiment supprimer cette page ?',
    'config.main': 'Configuration du site',
    'config.theme': 'Configuration du thème',
    'config.saveSuccess': 'Configuration enregistrée',
    'config.saveError': 'Échec de l\'enregistrement',
    'editor.meta': 'Métadonnées',
    'editor.content': 'Contenu',
    'editor.uploading': 'Téléversement...',
    'auth.login': 'Connexion',
    'auth.submit': 'Soumettre',
    'auth.username': 'Nom d\'utilisateur',
    'auth.password': 'Mot de passe',
    'auth.loginSuccess': 'Connexion réussie',
    'auth.loginError': 'Échec de connexion',
    'settings.darkMode': 'Mode sombre',
    'settings.lightMode': 'Mode clair',
  },
  'de': {
    'nav.posts': 'Beiträge',
    'nav.pages': 'Seiten',
    'nav.mainConfig': 'Site-Konfig.',
    'nav.themeConfig': 'Theme-Konfig.',
    'common.search': 'Suchen',
    'common.edit': 'Bearbeiten',
    'common.delete': 'Löschen',
    'common.save': 'Speichern (Ctrl+S)',
    'common.cancel': 'Abbrechen',
    'common.confirm': 'Bestätigen',
    'common.back': 'Zurück',
    'common.success': 'Erfolg',
    'common.title': 'Titel',
    'common.date': 'Datum',
    'common.updated': 'Aktualisiert',
    'common.actions': 'Aktionen',
    'common.status': 'Status',
    'common.draft': 'Entwurf',
    'common.published': 'Veröffentlicht',
    'common.publish': 'Veröffentlichen',
    'common.unpublish': 'Zurückziehen',
    'common.category': 'Kategorie',
    'common.tag': 'Tag',
    'common.all': 'Alle',
    'common.reset': 'Zurücksetzen',
    'posts.title': 'Beitragsverwaltung',
    'posts.newPost': 'Neuer Beitrag',
    'posts.editPost': 'Beitrag bearbeiten',
    'posts.deleteConfirm': 'Möchten Sie diesen Beitrag wirklich löschen?',
    'posts.publishConfirm': 'Möchten Sie diesen Beitrag wirklich veröffentlichen?',
    'posts.unpublishConfirm': 'Möchten Sie diesen Beitrag wirklich zurückziehen?',
    'pages.title': 'Seitenverwaltung',
    'pages.newPage': 'Neue Seite',
    'pages.editPage': 'Seite bearbeiten',
    'pages.deleteConfirm': 'Möchten Sie diese Seite wirklich löschen?',
    'config.main': 'Site-Konfiguration',
    'config.theme': 'Theme-Konfiguration',
    'config.saveSuccess': 'Konfiguration gespeichert',
    'config.saveError': 'Speichern fehlgeschlagen',
    'editor.meta': 'Metadaten',
    'editor.content': 'Inhalt',
    'editor.uploading': 'Wird hochgeladen...',
    'auth.login': 'Anmelden',
    'auth.submit': 'Absenden',
    'auth.username': 'Benutzername',
    'auth.password': 'Passwort',
    'auth.loginSuccess': 'Anmeldung erfolgreich',
    'auth.loginError': 'Anmeldung fehlgeschlagen',
    'settings.darkMode': 'Dunkelmodus',
    'settings.lightMode': 'Hellmodus',
  },
  'es': {
    'nav.posts': 'Entradas',
    'nav.pages': 'Páginas',
    'nav.mainConfig': 'Config. Sitio',
    'nav.themeConfig': 'Config. Tema',
    'common.search': 'Buscar',
    'common.edit': 'Editar',
    'common.delete': 'Eliminar',
    'common.save': 'Guardar (Ctrl+S)',
    'common.cancel': 'Cancelar',
    'common.confirm': 'Confirmar',
    'common.back': 'Volver',
    'common.success': 'Éxito',
    'common.title': 'Título',
    'common.date': 'Fecha',
    'common.updated': 'Actualizado',
    'common.actions': 'Acciones',
    'common.status': 'Estado',
    'common.draft': 'Borrador',
    'common.published': 'Publicado',
    'common.publish': 'Publicar',
    'common.unpublish': 'Despublicar',
    'common.category': 'Categoría',
    'common.tag': 'Etiqueta',
    'common.all': 'Todos',
    'common.reset': 'Restablecer',
    'posts.title': 'Gestión de entradas',
    'posts.newPost': 'Nueva entrada',
    'posts.editPost': 'Editar entrada',
    'posts.deleteConfirm': '¿Está seguro de que desea eliminar esta entrada?',
    'posts.publishConfirm': '¿Está seguro de que desea publicar esta entrada?',
    'posts.unpublishConfirm': '¿Está seguro de que desea despublicar esta entrada?',
    'pages.title': 'Gestión de páginas',
    'pages.newPage': 'Nueva página',
    'pages.editPage': 'Editar página',
    'pages.deleteConfirm': '¿Está seguro de que desea eliminar esta página?',
    'config.main': 'Configuración del sitio',
    'config.theme': 'Configuración del tema',
    'config.saveSuccess': 'Configuración guardada',
    'config.saveError': 'Error al guardar',
    'editor.meta': 'Metadatos',
    'editor.content': 'Contenido',
    'editor.uploading': 'Subiendo...',
    'auth.login': 'Iniciar sesión',
    'auth.submit': 'Enviar',
    'auth.username': 'Usuario',
    'auth.password': 'Contraseña',
    'auth.loginSuccess': 'Inicio de sesión exitoso',
    'auth.loginError': 'Error de inicio de sesión',
    'settings.darkMode': 'Modo oscuro',
    'settings.lightMode': 'Modo claro',
  },
  'ru': {
    'nav.posts': 'Статьи',
    'nav.pages': 'Страницы',
    'nav.mainConfig': 'Основные настройки',
    'nav.themeConfig': 'Настройки темы',
    'common.search': 'Поиск',
    'common.edit': 'Редактировать',
    'common.delete': 'Удалить',
    'common.save': 'Сохранить (Ctrl+S)',
    'common.cancel': 'Отмена',
    'common.confirm': 'Подтвердить',
    'common.back': 'Назад',
    'common.success': 'Успешно',
    'common.title': 'Заголовок',
    'common.date': 'Дата',
    'common.updated': 'Обновлено',
    'common.actions': 'Действия',
    'common.status': 'Статус',
    'common.draft': 'Черновик',
    'common.published': 'Опубликовано',
    'common.publish': 'Опубликовать',
    'common.unpublish': 'Снять с публикации',
    'common.category': 'Категория',
    'common.tag': 'Тег',
    'common.all': 'Все',
    'common.reset': 'Сброс',
    'posts.title': 'Управление статьями',
    'posts.newPost': 'Новая статья',
    'posts.editPost': 'Редактировать статью',
    'posts.deleteConfirm': 'Вы уверены, что хотите удалить эту статью?',
    'posts.publishConfirm': 'Вы уверены, что хотите опубликовать эту статью?',
    'posts.unpublishConfirm': 'Вы уверены, что хотите снять статью с публикации?',
    'pages.title': 'Управление страницами',
    'pages.newPage': 'Новая страница',
    'pages.editPage': 'Редактировать страницу',
    'pages.deleteConfirm': 'Вы уверены, что хотите удалить эту страницу?',
    'config.main': 'Основные настройки',
    'config.theme': 'Настройки темы',
    'config.saveSuccess': 'Настройки сохранены',
    'config.saveError': 'Ошибка сохранения',
    'editor.meta': 'Метаданные',
    'editor.content': 'Содержимое',
    'editor.uploading': 'Загрузка...',
    'auth.login': 'Войти',
    'auth.submit': 'Отправить',
    'auth.username': 'Имя пользователя',
    'auth.password': 'Пароль',
    'auth.loginSuccess': 'Вход выполнен',
    'auth.loginError': 'Ошибка входа',
    'settings.darkMode': 'Тёмная тема',
    'settings.lightMode': 'Светлая тема',
  },
  'pt': {
    'nav.posts': 'Publicações',
    'nav.pages': 'Páginas',
    'nav.mainConfig': 'Config. Site',
    'nav.themeConfig': 'Config. Tema',
    'common.search': 'Pesquisar',
    'common.edit': 'Editar',
    'common.delete': 'Excluir',
    'common.save': 'Salvar (Ctrl+S)',
    'common.cancel': 'Cancelar',
    'common.confirm': 'Confirmar',
    'common.back': 'Voltar',
    'common.success': 'Sucesso',
    'common.title': 'Título',
    'common.date': 'Data',
    'common.updated': 'Atualizado',
    'common.actions': 'Ações',
    'common.status': 'Status',
    'common.draft': 'Rascunho',
    'common.published': 'Publicado',
    'common.publish': 'Publicar',
    'common.unpublish': 'Despublicar',
    'common.category': 'Categoria',
    'common.tag': 'Tag',
    'common.all': 'Todos',
    'common.reset': 'Redefinir',
    'posts.title': 'Gerenciamento de publicações',
    'posts.newPost': 'Nova publicação',
    'posts.editPost': 'Editar publicação',
    'posts.deleteConfirm': 'Tem certeza de que deseja excluir esta publicação?',
    'posts.publishConfirm': 'Tem certeza de que deseja publicar esta publicação?',
    'posts.unpublishConfirm': 'Tem certeza de que deseja despublicar esta publicação?',
    'pages.title': 'Gerenciamento de páginas',
    'pages.newPage': 'Nova página',
    'pages.editPage': 'Editar página',
    'pages.deleteConfirm': 'Tem certeza de que deseja excluir esta página?',
    'config.main': 'Configuração do site',
    'config.theme': 'Configuração do tema',
    'config.saveSuccess': 'Configuração salva',
    'config.saveError': 'Erro ao salvar',
    'editor.meta': 'Metadados',
    'editor.content': 'Conteúdo',
    'editor.uploading': 'Enviando...',
    'auth.login': 'Entrar',
    'auth.submit': 'Enviar',
    'auth.username': 'Usuário',
    'auth.password': 'Senha',
    'auth.loginSuccess': 'Login bem-sucedido',
    'auth.loginError': 'Erro no login',
    'settings.darkMode': 'Modo escuro',
    'settings.lightMode': 'Modo claro',
  },
};

const STORAGE_KEY = 'hexo-dashboard-language';

function getDefaultLanguage(): Language {
  const stored = localStorage.getItem(STORAGE_KEY);
  if (stored && stored in messages) {
    return stored as Language;
  }
  const browserLang = navigator.language;
  if (browserLang.startsWith('zh')) {
    return browserLang.includes('TW') || browserLang.includes('HK') ? 'zh-TW' : 'zh-CN';
  }
  const langCode = browserLang.split('-')[0] || 'en';
  const match = languages.find(l => l.code === langCode || l.code.startsWith(langCode));
  return match ? match.code : 'en';
}

export const currentLanguage = ref<Language>(getDefaultLanguage());

export function setLanguage(lang: Language) {
  currentLanguage.value = lang;
  localStorage.setItem(STORAGE_KEY, lang);
  document.documentElement.lang = lang;
}

export function t(key: string): string {
  return messages[currentLanguage.value][key] || messages['en'][key] || key;
}

export function useI18n() {
  return {
    t,
    currentLanguage,
    setLanguage,
    languages,
  };
}
